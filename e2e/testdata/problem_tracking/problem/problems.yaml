apiVersion: v1
kind: Namespace
metadata:
  name: collector
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    nsSelector: problem-test
  name: problem-test-ns
---
apiVersion: telemetry.kube-logging.dev/v1alpha1
kind: Collector
metadata:
  name: problem-test-collector
spec:
  controlNamespace: collector
  tenantSelector:
    matchLabels:
      collectorLabel: problem-test
---
apiVersion: telemetry.kube-logging.dev/v1alpha1
kind: Tenant
metadata:
  labels:
    collectorLabel: problem-test
  name: problem-test-tenant
spec:
  subscriptionNamespaceSelectors:
    - matchLabels:
        nsSelector: problem-test
  logSourceNamespaceSelectors:
    - matchLabels:
        nsSelector: problem-test
---
apiVersion: telemetry.kube-logging.dev/v1alpha1
kind: Output
metadata:
  name: output-without-tenant
  namespace: problem-test-ns
spec:
  otlp:
    endpoint: receiver-collector.telemetry-controller-system.svc.cluster.local:4317
    tls:
      insecure: true
---
apiVersion: telemetry.kube-logging.dev/v1alpha1
kind: Subscription
metadata:
  name: valid-subscription
  namespace: problem-test-ns
spec:
  condition: "true"
  outputs:
    - name: output-without-tenant
      namespace: problem-test-ns
---
apiVersion: telemetry.kube-logging.dev/v1alpha1
kind: Subscription
metadata:
  name: subscription-missing-output
  namespace: problem-test-ns
spec:
  condition: "true"
  outputs:
    - name: non-existent-output
      namespace: problem-test-ns
---
apiVersion: v1
kind: Namespace
metadata:
  labels:
    nsSelector: other-tenant
  name: other-tenant-ns
---
apiVersion: telemetry.kube-logging.dev/v1alpha1
kind: Tenant
metadata:
  labels:
    collectorLabel: problem-test
  name: other-tenant
spec:
  subscriptionNamespaceSelectors:
    - matchLabels:
        nsSelector: other-tenant
  logSourceNamespaceSelectors:
    - matchLabels:
        nsSelector: other-tenant
---
apiVersion: telemetry.kube-logging.dev/v1alpha1
kind: Output
metadata:
  name: other-tenant-output
  namespace: other-tenant-ns
spec:
  otlp:
    endpoint: receiver-collector.telemetry-controller-system.svc.cluster.local:4317
    tls:
      insecure: true
---
apiVersion: telemetry.kube-logging.dev/v1alpha1
kind: Subscription
metadata:
  name: cross-tenant-subscription
  namespace: problem-test-ns
spec:
  condition: "true"
  outputs:
    - name: other-tenant-output
      namespace: other-tenant-ns
