receivers:
  file/in:
    path:
      /dev/stdin

exporters:
  file/tenantA:
    path:
      /foo/tenantA
  file/tenantB:
    path:
      /foo/tenantB

connectors:
  routing/tenants:
    default_pipelines: [logs/default]
    table:
      - statement: 'route() where attributes["kubernetes.namespace.labels.tenant"] == "A"'
        pipelines: [logs/tenant_A]
      - statement: 'route() where attributes["kubernetes.namespace.labels.tenant"] == "B"'
        pipelines: []

  routing/tenant_A_subscriptions:
    default_pipelines: [logs/tenant_A_default]
    table:
      - statement: 'route() where attributes["kubernetes.labels.app"] == "app1"'
        pipelines: [logs/tenant_A_subscription_A_S1]
      - statement: 'route() where attributes["kubernetes.labels.app"] == "app2"'
        pipelines: [logs/tenant_A_subscription_A_S2]

  routing/tenant_B_subscriptions:
    default_pipelines: [logs/tenant_B_default]
    table: []

service:
  pipelines:
    logs/all:
      receivers:
      - file/in
      processors:
      - kubernetes
      exporters:
      - routing/tenants
    
      
    logs/tenant_A:
      receivers:
      - routing/tenants
      processors:
      - "add tenant label"
      exporters:
      - routing/tenant_A_subscriptions

    logs/tenant_A_subscription_A_S1:
      receivers:
      - routing/tenant_A_subscriptions
      processors:
      - "add subscription label"    
      exporters:
      - file/tenantA
      - file/tenantB
    
      
    logs/tenant_A_subscription_A_S2:
      receivers:
      - routing/tenant_A_subscriptions
      exporters:
      - file/tenantA
    
      
    logs/tenant_B:
      receivers:
      - routing/tenants
      exporters:
      - routing/tenant_B_subscriptions
